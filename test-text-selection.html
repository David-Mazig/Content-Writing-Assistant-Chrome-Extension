<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test: Text Selection with ESC</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.8;
      background: #f5f5f5;
    }

    h1 {
      color: #333;
      border-bottom: 3px solid #4285f4;
      padding-bottom: 10px;
    }

    .test-section {
      background: white;
      padding: 30px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .instructions {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin: 20px 0;
    }

    .instructions strong {
      color: #1976d2;
    }

    .test-text {
      font-size: 16px;
      line-height: 1.8;
      padding: 20px;
      border: 2px dashed #ddd;
      border-radius: 4px;
      background: #fafafa;
      user-select: text;
      cursor: text;
    }

    .highlight-box {
      background: #fff3cd;
      border: 2px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    kbd {
      background: #333;
      color: white;
      padding: 3px 8px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>üß™ Test: Text Selection with ESC Key</h1>

  <div class="instructions">
    <strong>Test Instructions:</strong>
    <ol>
      <li><strong>Select some text</strong> in any of the paragraphs below</li>
      <li>Wait for the <strong>popover to appear</strong></li>
      <li>The selected text should <strong>remain visible</strong> (highlighted)</li>
      <li>Press <kbd>ESC</kbd> to close the popover</li>
      <li>The text should <strong>become selected again</strong> after closing</li>
    </ol>
  </div>

  <!-- Test Case 1: Simple paragraph -->
  <div class="test-section">
    <h2>Test Case 1: Simple Text Selection</h2>
    <div class="test-text">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Select any portion of this text
      and observe how the selection behaves when the popover appears. The selection should stay
      visible, and pressing ESC should restore it after the popover closes.
    </div>
  </div>

  <!-- Test Case 2: Multiple paragraphs -->
  <div class="test-section">
    <h2>Test Case 2: Multi-Paragraph Selection</h2>
    <div class="test-text">
      <p>
        <strong>First paragraph:</strong> Try selecting text that spans across multiple paragraphs.
        This tests whether the selection restoration works correctly with more complex selections.
      </p>
      <p>
        <strong>Second paragraph:</strong> The extension should preserve your entire selection range,
        including any whitespace and formatting between paragraphs.
      </p>
      <p>
        <strong>Third paragraph:</strong> When you press ESC, all of this should become selected again
        exactly as it was before the popover appeared.
      </p>
    </div>
  </div>

  <!-- Test Case 3: Text with formatting -->
  <div class="test-section">
    <h2>Test Case 3: Formatted Text</h2>
    <div class="test-text">
      This paragraph contains <strong>bold text</strong>, <em>italic text</em>, and
      <code>code snippets</code>. Select across these different formatting styles to ensure
      the selection restoration works correctly with rich text content.
    </div>
  </div>

  <!-- Test Case 4: Short selections -->
  <div class="test-section">
    <h2>Test Case 4: Short Selections</h2>
    <div class="test-text">
      Test with single words: <strong>apple</strong>, <strong>banana</strong>, <strong>cherry</strong>.
      Select just one word and verify the selection is restored after pressing ESC.
    </div>
  </div>

  <!-- Expected behavior -->
  <div class="highlight-box">
    <strong>‚úÖ Expected Behavior:</strong>
    <ul>
      <li><strong>Selection stays visible:</strong> When the popover appears, your text selection should remain highlighted in the background</li>
      <li><strong>ESC restores selection:</strong> Pressing <kbd>ESC</kbd> should close the popover AND restore the text selection</li>
      <li><strong>Exact restoration:</strong> The restored selection should match exactly what you originally selected</li>
    </ul>
  </div>

  <div class="highlight-box" style="background: #f8d7da; border-color: #dc3545;">
    <strong>‚ùå Previous Behavior (Fixed):</strong>
    <ul>
      <li>Selection disappeared when popover showed</li>
      <li>ESC removed the selection instead of restoring it</li>
    </ul>
  </div>

  <div class="test-section">
    <h2>Additional Test: Long Text</h2>
    <div class="test-text">
      The Content Writing Assistant extension helps you collect and organize content from across
      the web. You can save text selections, images, tables, and links to build a comprehensive
      research collection. All data is stored locally in your browser's IndexedDB, ensuring privacy
      and offline access. The extension uses Manifest V3 architecture for better security and performance.
      Features include drag-and-drop reordering, session-scoped undo/redo, progressive disclosure UI,
      and export functionality. Try selecting a large portion of this text to test how the selection
      restoration handles longer content. The extension should handle selections of any size, from
      a single character to entire documents. Press ESC after the popover appears and verify that
      your selection is accurately restored to its original state.
    </div>
  </div>
</body>
</html>
